networks:
  services:
services:
  apiserver:
    build:
      context: .
      dockerfile: cmd/apiserver/Dockerfile
    command: >
      apiserver
      --bind-interface="eth0"
      --config-dir="/config"
      --consul-addr="http://consul:8500"
      --verbose
    depends_on:
      - consul
    networks:
      - services
    volumes:
      - apiserver:/config
  block:
    build:
      context: .
      dockerfile: cmd/block/Dockerfile
    command: >
      block
      --apiserver-addr="apiserver:15760"
      --bind-interface="eth0"
      --config-dir="/config"
      --verbose
    depends_on:
      - apiserver
    networks:
      - services
    volumes:
      - block:/config
  consul:
    command: agent -bind '{{ GetInterfaceIP "eth0" }}' -client '{{ GetInterfaceIP "eth0" }}' -dev
    image: consul:1.9
    networks:
      - services
    ports:
      - 8500:8500
    volumes:
      - consul:/consul/data
version: "3.7"
volumes:
  apiserver:
  block:
  consul:
