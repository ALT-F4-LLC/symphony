syntax = "proto3";

option go_package = "github.com/erkrnt/symphony/api";

package api;

import "api/generic.proto";

service BlockControl {
  rpc Init(BlockControlInitRequest) returns (BlockControlInitResponse) {}
}

service BlockRemote {
  rpc Leave(BlockRemoteLeaveRequest) returns (SuccessStatusResponse) {}

  rpc GetLv(BlockRemoteLvRequest) returns (LogicalVolumeMetadata) {}
  rpc GetPv(BlockRemotePvRequest) returns (PhysicalVolumeMetadata) {}
  rpc GetVg(BlockRemoteVgRequest) returns (VolumeGroupMetadata) {}
  rpc NewLv(BlockRemoteNewLvRequest) returns (LogicalVolumeMetadata) {}
  rpc NewPv(BlockRemotePvRequest) returns (PhysicalVolumeMetadata) {}
  rpc NewVg(BlockRemoteNewVgRequest) returns (VolumeGroupMetadata) {}
  rpc RemoveLv(BlockRemoteLvRequest) returns (SuccessStatusResponse) {}
  rpc RemovePv(BlockRemotePvRequest) returns (SuccessStatusResponse) {}
  rpc RemoveVg(BlockRemoteVgRequest) returns (SuccessStatusResponse) {}
}

message BlockControlInitRequest { string ServiceAddr = 1; }
message BlockControlInitResponse {
  string ClusterID = 1;
  string ServiceID = 2;
}

message BlockRemoteLeaveRequest { string ServiceID = 1; }

message BlockRemoteLvRequest {
  string ID = 1;
  string VolumeGroupID = 2;
}

message BlockRemotePvRequest { string DeviceName = 1; }

message BlockRemoteVgRequest { string ID = 1; }

message BlockRemoteNewLvRequest {
  string ID = 1;
  string VolumeGroupID = 2;
  string Size = 3;
}

message BlockRemoteNewVgRequest {
  string DeviceName = 1;
  string ID = 2;
}

message LogicalVolume {
  string ID = 1;
  LogicalVolumeMetadata Metadata = 2;
  string ServiceID = 3;
  string VolumeGroupID = 4;
  int64 Size = 5;
}

message PhysicalVolume {
  string DeviceName = 1;
  string ID = 2;
  PhysicalVolumeMetadata Metadata = 3;
  string ServiceID = 4;
}

message VolumeGroup {
  string ID = 2;
  VolumeGroupMetadata Metadata = 3;
  string ServiceID = 4;
}

message LogicalVolumeMetadata {
  string LvName = 1;
  string VgName = 2;
  string LvAttr = 3;
  string LvSize = 4;
  string PoolLv = 5;
  string Origin = 6;
  string DataPercent = 7;
  string MetadataPercent = 8;
  string MovePv = 9;
  string MirrorLog = 10;
  string CopyPercent = 11;
  string ConvertLv = 12;
}

message PhysicalVolumeMetadata {
  string PvName = 1;
  string VgName = 2;
  string PvFmt = 3;
  string PvAttr = 4;
  string PvSize = 5;
  string PvFree = 6;
}

message VolumeGroupMetadata {
  string VgName = 1;
  string PvCount = 2;
  string LvCount = 3;
  string SnapCount = 4;
  string VgAttr = 5;
  string VgSize = 6;
  string VgFree = 7;
}